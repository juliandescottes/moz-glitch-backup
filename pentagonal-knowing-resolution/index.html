<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- 
      This is an HTML comment
      You can write text in a comment and the content won't be visible in the page
    -->

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="https://glitch.com/favicon.ico" />

    <!--
      This is the page head - it contains info the browser uses
      Like the title, which appears on the browser tab but not inside the page
      Further down you'll see the content that displays in the page
    -->
    <title>Hello World!</title>

    <!-- The website stylesheet -->
    <link rel="stylesheet" href="/style.css" />

    <!-- The website JavaScript file -->
    <script src="/script.js" defer></script>
  </head>
  <body>
    <p>POST raw test</p>

    <script type="text/javascript">
      /* exported performRequests performLargePostDataRequest */
      "use strict";

      function post(address, message) {
        return new Promise(resolve => {
          const xhr = new XMLHttpRequest();
          xhr.open("POST", address, true);
          xhr.setRequestHeader("Content-Type", "application/json");

          xhr.onreadystatechange = function() {
            if (this.readyState == this.DONE) {
              resolve();
            }
          };
          xhr.send(message);
        });
      }
      async function performLargePostDataRequest() {
        const limit = 1048576;
        const data = "x".repeat(2 * limit);
        await post("?test", JSON.stringify(data));
      }
      performLargePostDataRequest()
    </script>
  </body>
</html>
